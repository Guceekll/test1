from typing import List
from collections import defaultdict

# 模糊匹配关键词：表达结束意图、温和告别
END_PHRASES = [
    "没了", "没有了", "差不多", "就这样", "讲完了", "先这样吧", "大概就是这些",
    "我说完了", "我能想到的就这些了", "应该没其他问题了", "暂时就这些",
    "谢谢", "辛苦了", "感谢你的帮助", "帮大忙了",
    "that's all", "no more", "i'm done", "nothing else",
    "that’s everything", "thank you", "appreciate it"
]

# 用户说了结束的话（包括“谢谢”等温和结束）
def user_might_want_to_end(message: str) -> bool:
    msg = message.lower().strip()
    return any(phrase in msg for phrase in END_PHRASES)

# 回答是否在历史中重复 >= threshold 次
def has_repeated_answers(answers: List[str], threshold: int = 3) -> bool:
    count_map = defaultdict(int)
    for ans in answers:
        count_map[ans.strip()] += 1
    return any(count >= threshold for count in count_map.values())

# 检查最近几次用户输入是否全为空 / 敷衍
def user_gave_blank_responses(inputs: List[str], blank_threshold: int = 3) -> bool:
    BLANK_RESPONSES = {"", "不知道", "没注意", "忘了", "不清楚", "不记得", "无"}
    blanks = [msg.strip() for msg in inputs if msg.strip() in BLANK_RESPONSES]
    return len(blanks) >= blank_threshold
